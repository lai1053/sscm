## **CRM 对接方案：素材预审 + 素材告警 + 风控违规积分**

### **1. 背景与目标**

把巨量引擎的**素材风险治理链路**嵌入 CRM，形成「**投前预审**→**投中/投后告警**→**积分风险监控/处置**」闭环：

- 减少素材因违规导致的投放中断
- 提升运营/优化师处理效率（统一入口、留痕、可追溯）

## **2. 模块与页面规划（3 块）**

### **A）素材预审中心（投前拦截）**

**用途**：员工上传素材（本期先做视频）并发起预审，等待结果（通过/拒绝/原因），指导改稿与复审。

**核心链路**：上传视频拿 video_id → 发起预审 → 查询预审结果 → 留痕归档。

- 上传视频：/open_api/2/file/video/ad/ 
  - 广告账户上传视频接口 ：/open_api/2/file/video/ad/ 
  - 代理商上传视频接口：open_api/2/file/video/agent/
- 发起预审：/open_api/v3.0/security/open_material_audit/ 
- 查询预审结果：/open_api/v3.0/security/audit_results/ 

> 说明：预审结果接口返回 AUDITING/APPROVE/REJECT 与 reason_text，适合 CRM 做“等待/刷新/查看原因”的工作流。 

### **B）素材告警中心（投后治理：删除处置）**

**用途**：聚合违规素材/广告违规信息，支持“一键删除”，完成处置闭环（指派/备注/审计）。

**核心链路**：拉取告警 → 定位违规素材及关联广告 → 选择删除方式 → 留痕。

- 违规信息拉取（代理商视角）：/open_api/2/agent/query/risk_promotion_list/ 
- 删除素材库素材：
  - 删视频：/open_api/2/file/video/delete/ 
  - 删图片：/open_api/v3.0/file/image/delete/ 
  - 删图文：/open_api/2/carousel/delete/ 
- 删除广告下素材：/open_api/v3.0/promotion/material/delete/（仅支持巨量广告账户、且有“不能删到只剩 1 个素材”等限制） 

### **C）风控积分中心（风险量化与处置监控）**

**用途**：在 CRM 里展示广告主“违规积分”风险面板：累计扣分、违规扣分明细、处置（封停等）记录，便于提前预警与复盘。

**核心能力（3 个查询接口）**：

- 查询账户累计积分：/open_api/v3.0/security/score_total/get/ 
- 查询违规积分明细：/open_api/v3.0/security/score_violation_event/get/ 
- 查看积分处置详情：/open_api/v3.0/security/score_disposal_info/get/ 

**可选增强（SPI 推送，减少轮询）**：

- 违规积分事件：service_label = adv.violation.score 
- 积分处置事件：service_label = adv.disposal.score 

> 这组“积分 API + SPI”在巨量引擎更新日志中明确列出为新增能力。 

## **3. 每个页面的功能点（MVP）**

### **A）素材预审中心**

- 上传视频（文件/URL；保存 video_id/material_id）
- 发起预审（生成预审任务：object_id/task_id）
- 任务列表：审核状态、原因、创建人、更新时间
- 详情：素材预览、reason_text 可复制
- 操作：刷新结果（单条/批量）、撤回（如接口支持则加）

### **B）素材告警中心**

- 告警列表：按时间/广告主/广告/素材类型/关键词/处理状态筛选
- 告警详情：违规原因、关联素材与广告定位
- 删除处置（两种模式二选一）：
  1. **删素材库素材**（彻底禁止复用）
  2. **删广告下素材**（快速止血，保留素材库）
- 处理闭环：指派、备注、处理状态、操作审计

### **C）风控积分中心**

- 风险总览：年度累计分、按违规类型聚合（一般/严重等）
- 违规明细：扣分值、拒绝理由、证据截图字段（如有）、状态（申诉中/已申诉等） 
- 处置记录：处置开始/结束、处置原因/对外文案、处置单 id（用于客服/销售沟通） 





 \- 上传视频: curl -X POST 'http://localhost:8080/adminApi/qc/oe/material/precheck/uploadVideo?advertiserId=123' -H 'Authorization: Bearer <token>' -F 'file=@/tmp/demo.mp4'
代理商上传视频 http://localhost:8090/api/adminApi/qc/oe/material/precheck/uploadAgentVideo?agentId=123

分页查询上传记录 GET ：http://localhost:8090/api/adminApi/qc/oe/material/precheck/upload/list
上传记录详情  GET http://localhost:8090/api/adminApi/qc/oe/material/precheck/upload/detail?=upload

通过上传记录提交预审 http://localhost:8090/api/adminApi/qc/oe/material/precheck/submitByUploadRecordId

 \- 提交预审: curl -X POST 'http://localhost:8080/adminApi/qc/oe/material/precheck/submit' -H 'Content-Type: application/json' -d '{"advertiserId":123,"accountId":123,"videoId":"v1","businessType":"AD","channel":"ADS"}'

 \- 查询预审结果: curl -G 'http://localhost:8080/adminApi/qc/oe/material/precheck/result' --data-urlencode 'taskId=t1' --data-urlencode 'channel=ADS'

 \- 预审列表: curl -G 'http://localhost:8080/adminApi/qc/oe/material/precheck/list' --data-urlencode 'advertiserId=123' --data-urlencode 'status=SUBMITTED' --data-urlencode 'page=1' --data-urlencode 'pageSize=20'

 \- 素材删除: curl -X POST 'http://localhost:8080/adminApi/qc/oe/material/alert/delete' -H 'Content-Type: application/json' -d '{"advertiserId":123,"materialId":"mat123","campaignId":"cmp1","reason":"manual remove","channel":"ADS"}'

 \- 素材状态变更: curl -X POST 'http://localhost:8080/adminApi/qc/oe/material/alert/statusUpdate' -H 'Content-Type: application/json' -d '{"advertiserId":123,"materialId":"mat123","optStatus":"DISABLE","enableFlag":0,"channel":"ADS"}'

 \- 广告状态查询透传: curl -G 'http://localhost:8080/adminApi/qc/oe/material/alert/promotionList' --data-urlencode 'advertiserId=123' --data-urlencode 'materialId=mat123' --data-urlencode 'page=1' --data-urlencode 'pageSize=10'

 \- 积分总览: curl -G 'http://localhost:8080/adminApi/qc/oe/risk/scoreTotal' --data-urlencode 'advertiserId=123' --data-urlencode 'businessLine=AD' --data-urlencode 'year=2024' --data-urlencode 'channel=ADS'

 \- 违规事件列表: curl -G 'http://localhost:8080/adminApi/qc/oe/risk/violationEvents' --data-urlencode 'advertiserId=123' --data-urlencode 'businessLine=AD' --data-urlencode 'page=1' --data-urlencode 'pageSize=20'

 \- 处置详情列表: curl -G 'http://localhost:8080/adminApi/qc/oe/risk/disposalInfos' --data-urlencode 'advertiserId=123' --data-urlencode 'businessLine=AD' --data-urlencode 'page=1' --data-urlencode 'pageSize=20'

 \- SPI 违规积分回调: curl -X POST 'http://localhost:8080/open/spi/oceanengine/violationScore' -H 'Content-Type: application/json' -H 'X-Open-Signature:<sig>' -d '{"message_id":"m1","service_label":"adv.violation.score","advertiser_id":123,"publish_time":1700000000,"data":{"content":

  {"event_id":"E1","business_line":"AD","score":5}}}'

 \- SPI 处置积分回调: curl -X POST 'http://localhost:8080/open/spi/oceanengine/disposalScore' -H 'Content-Type: application/json' -H 'X-Open-Signature:<sig>' -d '{"message_id":"m2","service_label":"adv.disposal.score","advertiser_id":123,"data":{"content":

  {"disposal_id":"D1","business_line":"AD","disposal_status":"ONGOING"}}}'

1、上传记录元信息更新

2、预审详情聚合
3、告警主动拉取
4、告警列表

5、告警处理

6、操作日志查询

后续新增
- 上传记录元信息更新

  curl -X POST 'http://localhost:8080/adminApi/qc/oe/material/upload/updateMeta' \
    -H 'Content-Type: application/json' \
    -d '{"uploadRecordId":1,"displayName":"新名称","remark":"备注"}'

  - 预审详情聚合

  curl -G 'http://localhost:8080/adminApi/qc/oe/material/precheck/detail' \
    --data-urlencode 'precheckTaskId=1'

  - 预审批量刷新

  curl -X POST 'http://localhost:8080/adminApi/qc/oe/material/precheck/refreshBatch' \
    -H 'Content-Type: application/json' \
    -d '{"advertiserId":123,"statusIn":["SUBMITTED","AUDITING"],"limit":20}'

  - 告警主动拉取

  curl -X POST 'http://localhost:8080/adminApi/qc/oe/material/alert/syncPull' \
  
    -H 'Content-Type: application/json' \
    -d '{"agentId":123,"startDate":"2024-01-01","endDate":"2024-02-15","types":["VIDEO"],"pageSize":200}'
  
  - 告警列表
  
  curl -G 'http://localhost:8080/adminApi/qc/oe/material/alert/list' \
    --data-urlencode 'advertiserId=123' \
    --data-urlencode 'handled=false' \
    --data-urlencode 'page=1' \
    --data-urlencode 'pageSize=20'
  
  - 告警处理
  
  curl -X POST 'http://localhost:8080/adminApi/qc/oe/material/alert/handle' \
    -H 'Content-Type: application/json' \
    -d '{"alertId":1,"action":"DELETE","advertiserId":123,"promotionId":456,"materialId":789,"reason":"manual remove","channel":"ADS"}'
  
  - 操作日志查询
  
  curl -G 'http://localhost:8080/adminApi/qc/oe/material/oplog/list' \
    --data-urlencode 'opType=ALERT_HANDLE' \
    --data-urlencode 'page=1' \
    --data-urlencode 'pageSize=20'



```javascript
{"code":0,"message":"OK","request_id":"20251224182643331B563803B7F9A3B922","data":{"duration":8,"height":720,"material_id":7586947371754897451,"size":2906436,"video_id":"v1e033gi0000d55q917og65jjibdbo8g","video_signature":"eff2526aad09807779993c93a8db9356","video_url":"https://cc.oceanengine.com/anm/CtcDcZxctqUpfVsB-zI3pmVg0Y9e2lfamBD7EK_Zc4Er-GYz5YI9_B5CnOTRdyN7ewUzuyyD3mGl9nAdNCq2KN1UT929AJX2okcnkxFvFIITy1Hx_Zr3jATvTdGgIItF6cZPUy6ljUQfmp0K_vH3ND9zPaRq_fLeBXMBoOXEF9MvMu6Crqj-tkG9SnpwxewVX4kK_uG9D4cD1T7NQ8TESM4YDMVgZIZbheTujdFFa1UBB2Dktlm1T6ekj-s7TJwPfDcdJ-Zq8q67M106jFWBA_hrjOokrJLFvxX34QZ_Usd0ST46S7bFjKU-TjxmG91lcrHm3uGCOuXlm3IYz1oqkXqUzuUfqLCHuvuRs0BsKvvPUpxSY8tn3xORkDDh0IW_bxYFkIZ2Lo65F1lqeI_B1DV3sOZz6pSABKAzAjQf08AOnUmLDzFQPrlqGx_WuMWgk7ZzaUXPe35ofWQD97BNyViyfwN8DBWXHbKCskhptj9ZUdzEJzIDuGNIQWvoYnk30jKX9xdJCYHpcmlzEyxeyY9uHLwMbEE2cAnnEImLm03uKvClo_bpidFUc1IJuWxQ3L-cjVnTGRSPV596yNwlIriDr9sHE560iW5K_fKE_DY6Nzp69KnfAsesGksKPAAAAAAAAAAAAABP3vVyi1v1aWdOM0Q1l1H6SFrmx5R5q8p_BBo4xBsJLkFOYhBTRkcKZc31vT2cZdFnBhC-hIUOGO3y_-EBIAEiAQMlA2UB","width":1280}}
```





